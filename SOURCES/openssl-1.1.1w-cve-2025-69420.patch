From 9b4d78b376fa2049ba3b43b2c27cc015088627dd Mon Sep 17 00:00:00 2001
From: Dmitriy Popov <dpopov@cloudlinux.com>
Date: Thu, 29 Jan 2026 04:14:13 +0200
Subject: [PATCH 2/7] openssl-1.1.1w-cve-2025-69420
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Backport the following upstream commit:

    From ea8fc4c345fbd749048809c9f7c881ea656b0b94 Mon Sep 17 00:00:00 2001
    From: Bob Beck <beck@openssl.org>
    Date: Wed Jan 7 11:29:48 2026 -0700
    Subject: [PATCH] Verify ASN1 object's types before attempting to access
    them as a particular type

    Issue was reported in ossl_ess_get_signing_cert but is also present
    in ossl_ess_get_signing_cert_v2.

    CVE-2025-69420

    Fixes: https://github.com/openssl/srt/issues/61

    Reviewed-by: Norbert Pocs <norbertp@openssl.org>
    Reviewed-by: Saša Nedvědický <sashan@openssl.org>
    Reviewed-by: Tomas Mraz <tomas@openssl.org>
    (Merged from https://github.com/openssl/openssl/pull/29555)

Signed-off-by: Dmitriy Popov <dpopov@cloudlinux.com>
---
 crypto/ts/ts_rsp_verify.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/crypto/ts/ts_rsp_verify.c b/crypto/ts/ts_rsp_verify.c
index 7fe3d27..5d452d2 100644
--- a/crypto/ts/ts_rsp_verify.c
+++ b/crypto/ts/ts_rsp_verify.c
@@ -262,7 +262,7 @@ static ESS_SIGNING_CERT *ess_get_signing_cert(PKCS7_SIGNER_INFO *si)
     ASN1_TYPE *attr;
     const unsigned char *p;
     attr = PKCS7_get_signed_attribute(si, NID_id_smime_aa_signingCertificate);
-    if (!attr)
+    if (attr == NULL || attr->type != V_ASN1_SEQUENCE)
         return NULL;
     p = attr->value.sequence->data;
     return d2i_ESS_SIGNING_CERT(NULL, &p, attr->value.sequence->length);
@@ -274,7 +274,7 @@ static ESS_SIGNING_CERT_V2 *ess_get_signing_cert_v2(PKCS7_SIGNER_INFO *si)
     const unsigned char *p;
 
     attr = PKCS7_get_signed_attribute(si, NID_id_smime_aa_signingCertificateV2);
-    if (attr == NULL)
+    if (attr == NULL || attr->type != V_ASN1_SEQUENCE)
         return NULL;
     p = attr->value.sequence->data;
     return d2i_ESS_SIGNING_CERT_V2(NULL, &p, attr->value.sequence->length);
-- 
2.34.1

